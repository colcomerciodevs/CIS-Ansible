---

## Crear Grupo para restringir el acceso SSH
- name: Crear un grupo en el sistema
  ansible.builtin.group:
    name: ssh_access
    state: present


# ONPREMISE â†’ usuario tux
- name: Agregar tux a ssh_access SOLO si existe
  ansible.builtin.user:
    name: tux
    groups: ssh_access
    append: true
  when:
    - "'Servidor Onpremise - Nuevo' in type_server or
       'Servidor Onpremise - Produccion' in type_server"
    - lookup('ansible.builtin.passwd', 'tux', errors='ignore') is not none


## usuarios criticos de OCI - PEOPLESOFT
- name: Agregar usuarios OCI a ssh_access SOLO si existen
  ansible.builtin.user:
    name: "{{ item }}"
    groups: ssh_access
    append: true
  loop:
    - adminso
    - psoft
    - opc
  when:
    - "'Servidor OCI - People' in type_server"
    - lookup('ansible.builtin.passwd', item, errors='ignore') is not none


